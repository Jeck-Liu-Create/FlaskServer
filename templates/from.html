<!doctype html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width" />
    <title>磨床数据采集发送系统</title>
<!--    @*1、Jquery组件引用*@-->
    <script src="../static/js/jquery-3.5.1.min.js"></script>

<!--    @*2、bootstrap组件引用*@-->
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <script src="../static/js/bootstrap.min.js"></script>

<!--    @*3、bootstrap table组件以及中文包的引用*@-->
    <link rel="stylesheet" href="../static/css/bootstrap-table.min.css">
    <script src="../static/js/bootstrap-table.min.js"></script>
    <script src="../static/js/bootstrap-table-zh-CN.min.js"></script>
    <script src="../static/js/tableExport.min.js"></script>
    <script src="../static/js/bootstrap-table-export.js"></script>
</head>
<body>

<div class="modal fade" id="myModal" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">编辑轧辊数据</h4>
            </div>
            <div class="modal-body">
                <form action="" class="form-horizontal">
                    <div class="form-group">
                        <label for="modal_c_frame_id" class="col-sm-2 control-label">机架号</label>
                        <div class="col-sm-3">
                            <select id="modal_c_frame_id" class="form-control" name="c_frame_id" >
                                <option selected hidden disabled value="">选择机架号</option>
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                            </select>
                        </div>
                        <label for="modal_c_roll_type" class="col-sm-2 control-label">轧辊类型</label>
                        <div class="col-sm-3">
                            <select id="modal_c_roll_type" class="form-control" name="c_roll_type" >
                                <option selected hidden disabled value="">选择轧辊类型</option>
                                <option>W:工作辊</option>
                                <option>B:支撑辊</option>
                                <option>M:中间辊</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="modal_c_roll_position" class="col-sm-2 control-label">轧辊位置</label>
                        <div class="col-sm-3">
                            <select id="modal_c_roll_position" class="form-control" name="c_roll_position" >
                                <option selected hidden disabled value="">选择轧辊位置</option>
                                <option>U:上辊</option>
                                <option>L:下辊</option>
                            </select>
                        </div>
                        <label for="modal_c_roll_material" class="col-sm-2 control-label">轧辊材质</label>
                        <div class="col-sm-3">
                            <select id="modal_c_roll_material" class="form-control" name="c_roll_material" >
                                <option selected hidden disabled value="">选择轧辊材质</option>
                                <option>01:CastSteel</option>
                                <option>02:Ni-Cr</option>
                                <option>03:Hi-Cr</option>
                                <option>04:HSS(高速钢)</option>
                                <option>05:MC5</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="modal_c_diameter" class="col-sm-2 control-label">轧辊直径</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" disabled="disabled" id="modal_c_diameter">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="modal_c_actual_convexity" class="col-sm-2 control-label">轧辊凸度</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" disabled="disabled" id="modal_c_actual_convexity">
                        </div>
                        <label for="modal_c_roll_position" class="col-sm-2 control-label">凸度正负标记</label>
                        <div class="col-sm-3">
                            <select id="modal_c_crown_symbol " class="form-control" name="c_crown_symbol" >
                                <option selected hidden disabled value="">选择凸度正负标记</option>
                                <option>1:负</option>
                                <option>2:正</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="modal_c_roughness" class="col-sm-2 control-label">粗糙度</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control"  id="modal_c_roughness">
                        </div>
                        <label for="modal_c_do" class="col-sm-2 control-label">表面加工方式</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" disabled="disabled" id="modal_c_do" value="磨削">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="modal_c_side_bearing" class="col-sm-2 control-label">操作侧轴承号</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="modal_c_side_bearing">
                        </div>
                        <label for="modal_c_drive_bearing" class="col-sm-2 control-label">驱动侧轴承号</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="modal_c_drive_bearing">
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="hidden" class="form-control" disabled="disabled" id="modal_c_id">
                        <label for="modal_c_roll_number" class="col-sm-2 control-label">轧辊编号</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" disabled="disabled" id="modal_c_roll_number">
                        </div>
                        <label for="modal_c_pairing_roll" class="col-sm-2 control-label">配对辊号</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="modal_c_pairing_roll">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="modal_c_top_diameter" class="col-sm-2 control-label">锥形顶端直径</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="modal_c_top_diameter">
                        </div>
                        <label for="modal_c_low_diameter" class="col-sm-2 control-label">锥形底端直径</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="modal_c_low_diameter">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="sava-edit-btn">保存</button>
            </div>
        </div>
    </div>
</div>

<nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">磨床数据采集发送系统</a>
        </div>
        <div  class="navbar-form navbar-left" role="search">
            <div class="form-group">
<!--                <input type="text" class="form-control" placeholder="Search">-->
                <lable>磨床:</lable>
                <select id="roll" class="form-control" name="ROLL" >
                    <option>0号磨床(HIECISE-MK84160)</option>
                    <option>1号磨床(HIECISE-MK84125-01)</option>
                    <option>2号磨床(HIECISE-MK84125-02)</option>
                    <option>3号磨床(HIECISE-MK84125-03)</option>
                </select>
            </div>
            <div class="form-group">
                <lable>开始时间:</lable>
                <input type="datetime-local" step="1" class="start-time"  id="s_time" />
                <lable>结束时间:</lable>
                <input type="datetime-local" step="1" class="end-time" id="e_time"/>
<!--                <input type="submit" value="提交" ></input>-->
                <button id="send" class="btn btn-default">搜索</button>
            </div>

        </div>

        </div>
    </nav>
<!--{#     推荐用这种方式，比较灵活#}-->

<div style="width: 80%;margin: 0 auto">
     <div class="pull-left" style="padding-top: 10px">
         <span id="exportToolbar" style="display: inline-block" class="btn-group">
             <select id="sel_exportoption" class="form-control">
                 <option value="">导出当前页数据</option>
                 <option value="all">导出全部数据</option>
                 <option value="selected">导出选中数据</option>
             </select>
         </span>
     </div>
    <table id="tabledata" class="table " ></table>
</div>





<script type="text/javascript">

//返回开始时间
    function StartTime()
    {
        var now = new Date();

        var year = now.getFullYear();       //年
        var month = now.getMonth() + 1;     //月
        var day = now.getDate();            //日


        var clock = year + "-";

        if(month < 10)
            clock += "0";

        clock += month + "-";

        if(day < 10)
            clock += "0";

        clock += day + "T";

        clock += "00:00:00";
        return(clock);
    }
//返回结束日期
    function EndTime()
    {
        var now = new Date();

        var year = now.getFullYear();       //年
        var month = now.getMonth() + 1;     //月
        var day = now.getDate();            //日

        var hh = now.getHours();            //时
        var mm = now.getMinutes();          //分
        var ss = now.getSeconds() ;         //秒


        var clock = year + "-";

        if(month < 10)
            clock += "0";

        clock += month + "-";

        if(day < 10)
            clock += "0";

        clock += day + "T";

        if(hh < 10)
            clock += "0";

        clock += hh + ":";

        if (mm < 10)
            clock += '0';

        clock += mm + ":";

        if (ss < 10)
            clock += '0';

        clock += ss ;

        return(clock);
    }
    //时间初始化
    $(function(){

       $('#s_time').val(StartTime())
    });
    $(function(){

       $('#e_time').val(EndTime())
    });

    function updata() {
        StartTime:$('#s_time').val();
        ROLL:$('#roll').val();
	    $('#tabledata').bootstrapTable({
        // ajax : function (request) {
        //     $.ajax({
        //         type : "GET",
        //         url : "/reload",
        //         contentType: "application/json;charset=utf-8",
        //         dataType:"json",//,offset:$('#tabledata').bootStrapTable('getOptions').pageNumber,limit:$('#bootStrapTableId').bootStrapTable('getOptions').limit
        //         data: {ROLL:$('#roll').val(), StartTime:$('#s_time').val(), EndTime:$('#e_time').val(),offset:$('#tabledata').bootStrapTable('getOptions').pageNumber,limit:$('#bootStrapTableId').bootStrapTable('getOptions').limit },
        //         success : function (msg) {
        //             request.success({
        //                 row : msg
        //             });
        //             $('#tabledata').bootstrapTable('load', msg);
        //         },
        //         error:function(){
        //             alert("错误");
        //         }
        //     });
        // },
        url:'/reload',
        queryParams : function(params) {
				return {
					limit: params.limit,
					offset: params.offset,
	               // userName: $.trim( $('#userName').val() ) ,
	               // age: $.trim( $('#age').val() ) ,
                    ROLL:$('#roll').val(),
                    StartTime:$('#s_time').val(),
                    EndTime:$('#e_time').val()
				}
			},

		toolbar:'#toolbox',
        pagination: true, //前端处理分页
        singleSelect: false,//是否只能单选
        cache: true, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pageNumber: 1, //初始化加载第10页，默认第一页
        pageSize: 10, //每页的记录行数（*）
        pageList: [10, 20, 50, 100], //可供选择的每页的行数（*）
		clickToSelect:true,
		sortName: "create_time",
		sortOrder: "desc",
        showColumns: true, //显示内容列下拉框
        minimumCountColumns: 2, //当列数小于此值时，将隐藏内容列下拉框
        uniqueId: "id", //每一行的唯一标识，一般为主键列
        showToggle: true, //是否显示详细视图和列表视图的切换按钮
        cardView: false, //是否显示详细视图
       // queryParamsType:'limit',
        sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
        showExport: true, //导出按钮
        exportDataType: "selected", //导出表格方式（默认basic：只导出当前页的表格数据；all：导出所有数据；selected：导出选中的数据）
        exportTypes: ['json', 'xml', 'csv', 'txt', 'sql', 'excel'], //导出文件类型
		columns: [{
                checkbox: true,
                visible: true,
            },{
                field: 'c_id',
                title: '序号',
                align: 'center',  //对齐方式，居中
                // formatter: actionFormatter,
            }, {
                field: 'c_roll_number',
                title: '辊号',
                align: 'center'
            }, {
                field: 'c_program_number',
                title: '程序号',
                align: 'center',
            }, {
                field: 'c_operator',
                title: '操作者',
                align: 'center',
            }, {
                field: 'c_shift',
                title: '班次',
                align: 'center',
            }, {
                field: 'c_curve',
                title: '曲线',
                align: 'center',
            }, {
                field: 'c_diameter',
                title: '直径',
                align: 'center',
            }, {
                field: 'c_diameter_before',
                title: '磨前直径',
                align: 'center',
            }, {
                field: 'c_error',
                title: '误差',
                align: 'center',
            }, {
                field: 'c_coaxiality',
                title: '同轴度',
                align: 'center',
            }, {
                field: 'c_cylindricity',
                title: '圆柱度',
                align: 'center',
            }, {
                field: 'c_roundness',
                title: '圆度',
                align: 'center',
            }, {
                field: 'c_wheel_diameter',
                title: '砂轮直径',
                align: 'center',
            }, {
                field: 'c_actual_convexity',
                title: '实际凸度',
                align: 'center',
            }, {
                field: 'c_start_time',
                title: '开始时间',
                align: 'center',
            }, {
                field: 'c_end_time',
                title: '结束时间',
                align: 'center',
            }, {
                field: 'c_grinding_machine',
                title: '磨床',
                align: 'center',
            }, {
                field: 'c_date',
                title: '日期',
                align: 'center',
            },
            {
                field: 'c_frame_id',
                title: '机架号',
                align: 'center',
            },
            {
                title: '操作',
                field: 'c_id',
                align: 'center',
                formatter: actionFormatter
            //     // formatter: function (value, row) {
            //     //     var e = '<a href="#" mce_href="#" onclick="edit(\'' + row.c_id + '\')">编辑</a> ';  //row.id为每行的id
            //     //     var d = '<a href="#" mce_href="#" onclick="del(\'' + row.c_id + '\')">删除</a> ';
            //     //     return e + d;
            //     // }
            },
        ],
        onLoadSuccess: function (){
        },
        onLoadError: function (){
            showTips("数据加载失败！");
        },
        onDblClickRow: function (row, $element) {
            var id = row.ID;
            EditViewById(id, 'view');
        }

    });

    }



    function actionFormatter(value, row ,index) {
        var id = value;
        var result = "";
        // list = [ ID , 轧辊号 ， 直径 ， 实际凸度 ， 机架号]
        var list = [row.c_id,row.c_roll_number,row.c_diameter,row.c_actual_convexity,row.c_frame_id];
        var c_id = row.c_id;
        var c_frame_id = row.c_frame_id;
        // var c_roll_number = row.c_roll_number;
        // var c_program_number = row.c_program_number;
        // var
        // list.push(c_id);
        // list.push(c_frame_id)



        result += "<a href='javascript:;' class='btn btn-xs green' onclick=\"EditViewById('"+ list + "', view='view')\" title='查看'><span class='glyphicon glyphicon-search'></span></a>";
        result += "<a href='javascript:;' class='btn btn-xs blue' onclick=\"EditViewById('" + list + "')\" title='编辑'><span class='glyphicon glyphicon-pencil'></span></a>";
        result += "<a href='javascript:;' class='btn btn-xs red' onclick=\"DeleteByIds('" + list + "')\" title='删除'><span class='glyphicon glyphicon-remove'></span></a>";
        return result;
    }
    function EditViewById(data){
        alert(data);

        let row = data.split(",");
        // console.log(typeof(row[1]));
        // var row = $("tabledata").bootstrapTable('getData',false);
        $("#modal_c_id").val(row[0]);//数据库ID
        $("#modal_c_roll_number").val(row[1]);//轧辊编号
        console.log('轧辊标号'+row[1]);
        $("#modal_c_diameter").val(row[2]);//直径
        $("#modal_c_actual_convexity").val(row[3]);//凸度
        $("#modal_c_frame_id").val(row[4]);//机架号
        $("#myModal").modal();
    }
    // $('#delModal').on('show.bs.modal' , function (event)){
    //
    // }


    $(function (){updata()})

    $('#send').click(function(){

        console.log('dd');

        $("#tabledata").bootstrapTable('destroy');

        updata();
    });




    $(function(){

       $('#s_time').val(StartTime())

});
    $(function(){

       $('#e_time').val(EndTime())

});



</script>
</body>
</html>